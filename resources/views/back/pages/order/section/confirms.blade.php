<div class="sub_orderTabContent confirmedOrders" data-id="confirmedOrders">
    <div class="confirmedOrders-table">
        <table>
            <thead>
                <tr>
                    <th>{{ trns('tracking_code') }}</th>
                    <th>{{ trns('added_person') }}</th>
                    <th>{{ trns('customer') }}</th>
                    <th>{{ trns('apply_date') }}</th>
                    <th>{{ trns('product') }}</th>
                    <th>{{ trns('cargo_type') }}</th>
                    <th>{{ trns('cube') }}</th>
                    <th>{{ trns('price') }}</th>
                    <th>{{ trns('contract') }}</th>
                    <th>{{ trns('invoice') }}</th>
                    <th>{{ trns('packing_list') }}</th>
                    <th>{{ trns('status') }}</th>
                    <th>&nbsp;</th>
                </tr>
            </thead>
            <tbody>
                @foreach ($order_items as $order_item)
                    @php
                        $products = '';
                        $contract_files = [];
                        $invoice_files = [];
                        $packing_list_files = [];
                        $counter = 0;

                        $order_factory_ids = explode(',', $order_item->order_factory_ids);
                        $order_factories = \App\Models\OrderFactory::whereIn('id', $order_factory_ids)->get();
                        foreach ($order_factories as $order_factory) {
                            foreach ($order_factory->products as $factory_product) {
                                $counter++;
                                $products .= "$counter . " . $factory_product->product->name . '</br>';
                            }

                            if (!is_null($order_factory->file) && !empty($order_factory->file->contract)) {
                                $contract_files[] = $order_factory->file->contract;
                            }

                            if (!is_null($order_factory->file) && !empty($order_factory->file->invoice)) {
                                $invoice_files[] = $order_factory->file->invoice;
                            }

                            if (!is_null($order_factory->file) && !empty($order_factory->file->packing_list)) {
                                $packing_list_files[] = $order_factory->file->packing_list;
                            }
                        }

                        $status_change_ids = explode(',', $order_item->status_change_ids);
                        $latest_status = \App\Models\OrderItemStatusChange::whereIn('id', $status_change_ids)
                            ->orderBy('id', 'desc')
                            ->first();

                        $order = $order_item->order;
                    @endphp
                    <tr>
                        <td>{{ $order_item->code }}</td>
                        <td>{{ $order_item->user_name ?? '-' }}</td>
                        <td>{{ $order_item->company_name ? $order_item->company_name : $order_item->customer_name ?? '-' }}
                        </td>
                        <td>{{ \Carbon\Carbon::parse($order_item->apply_date)?->format('d/m/Y') ?? '-' }}</td>
                        <td>{{ $order_item->product_name ?? ' - ' }}</td>
                        <td>{{ $order_item->mix_full == 'mix' ? trns('mix') : ($order_item->mix_full == 'full' ? trns('full') : trns('automobile')) }}
                        </td>
                        <td>{{ $order_item->cbm ?? '-' }}</td>
                        <td>{{ ($order_item->price ?? 0) . ' $' }}</td>
                        <td>
                            <div class="contract-items">
                                @if (count($contract_files) == 0)
                                    <a href="#" class="contract-item">
                                        <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M28.8767 11.0757L21.4392 3.63817C21.3405 3.53954 21.2233 3.46132 21.0943 3.408C20.9653 3.35467 20.8271 3.32728 20.6875 3.32739H7.9375C7.37391 3.32739 6.83341 3.55128 6.4349 3.94979C6.03638 4.34831 5.8125 4.88881 5.8125 5.45239V28.8274C5.8125 29.391 6.03638 29.9315 6.4349 30.33C6.83341 30.7285 7.37391 30.9524 7.9375 30.9524H27.0625C27.6261 30.9524 28.1666 30.7285 28.5651 30.33C28.9636 29.9315 29.1875 29.391 29.1875 28.8274V11.8274C29.1876 11.6878 29.1602 11.5496 29.1069 11.4206C29.0536 11.2916 28.9754 11.1744 28.8767 11.0757ZM21.75 23.5149H13.25C12.9682 23.5149 12.698 23.403 12.4987 23.2037C12.2994 23.0044 12.1875 22.7342 12.1875 22.4524C12.1875 22.1706 12.2994 21.9003 12.4987 21.7011C12.698 21.5018 12.9682 21.3899 13.25 21.3899H21.75C22.0318 21.3899 22.302 21.5018 22.5013 21.7011C22.7006 21.9003 22.8125 22.1706 22.8125 22.4524C22.8125 22.7342 22.7006 23.0044 22.5013 23.2037C22.302 23.403 22.0318 23.5149 21.75 23.5149ZM21.75 19.2649H13.25C12.9682 19.2649 12.698 19.153 12.4987 18.9537C12.2994 18.7544 12.1875 18.4842 12.1875 18.2024C12.1875 17.9206 12.2994 17.6503 12.4987 17.4511C12.698 17.2518 12.9682 17.1399 13.25 17.1399H21.75C22.0318 17.1399 22.302 17.2518 22.5013 17.4511C22.7006 17.6503 22.8125 17.9206 22.8125 18.2024C22.8125 18.4842 22.7006 18.7544 22.5013 18.9537C22.302 19.153 22.0318 19.2649 21.75 19.2649ZM20.6875 11.8274V5.98364L26.5312 11.8274H20.6875Z"
                                                fill="#DDDDDD" />
                                        </svg>
                                    </a>
                                @else
                                    @foreach ($contract_files as $file)
                                        <a href="{{ empty($file) ? '#' : asset($file) }}" target="_blank"
                                            class="contract-item {{ !empty($file) ? 'active' : '' }}">
                                            <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M28.8767 11.0757L21.4392 3.63817C21.3405 3.53954 21.2233 3.46132 21.0943 3.408C20.9653 3.35467 20.8271 3.32728 20.6875 3.32739H7.9375C7.37391 3.32739 6.83341 3.55128 6.4349 3.94979C6.03638 4.34831 5.8125 4.88881 5.8125 5.45239V28.8274C5.8125 29.391 6.03638 29.9315 6.4349 30.33C6.83341 30.7285 7.37391 30.9524 7.9375 30.9524H27.0625C27.6261 30.9524 28.1666 30.7285 28.5651 30.33C28.9636 29.9315 29.1875 29.391 29.1875 28.8274V11.8274C29.1876 11.6878 29.1602 11.5496 29.1069 11.4206C29.0536 11.2916 28.9754 11.1744 28.8767 11.0757ZM21.75 23.5149H13.25C12.9682 23.5149 12.698 23.403 12.4987 23.2037C12.2994 23.0044 12.1875 22.7342 12.1875 22.4524C12.1875 22.1706 12.2994 21.9003 12.4987 21.7011C12.698 21.5018 12.9682 21.3899 13.25 21.3899H21.75C22.0318 21.3899 22.302 21.5018 22.5013 21.7011C22.7006 21.9003 22.8125 22.1706 22.8125 22.4524C22.8125 22.7342 22.7006 23.0044 22.5013 23.2037C22.302 23.403 22.0318 23.5149 21.75 23.5149ZM21.75 19.2649H13.25C12.9682 19.2649 12.698 19.153 12.4987 18.9537C12.2994 18.7544 12.1875 18.4842 12.1875 18.2024C12.1875 17.9206 12.2994 17.6503 12.4987 17.4511C12.698 17.2518 12.9682 17.1399 13.25 17.1399H21.75C22.0318 17.1399 22.302 17.2518 22.5013 17.4511C22.7006 17.6503 22.8125 17.9206 22.8125 18.2024C22.8125 18.4842 22.7006 18.7544 22.5013 18.9537C22.302 19.153 22.0318 19.2649 21.75 19.2649ZM20.6875 11.8274V5.98364L26.5312 11.8274H20.6875Z"
                                                    fill="#DDDDDD" />
                                            </svg>
                                        </a>
                                    @endforeach
                                @endif
                            </div>
                        </td>
                        <td>
                            <div class="invoice-items">
                                @if (count($invoice_files) == 0)
                                    <a href="#" class="invoice-item">
                                        <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M28.8767 11.0757L21.4392 3.63817C21.3405 3.53954 21.2233 3.46132 21.0943 3.408C20.9653 3.35467 20.8271 3.32728 20.6875 3.32739H7.9375C7.37391 3.32739 6.83341 3.55128 6.4349 3.94979C6.03638 4.34831 5.8125 4.88881 5.8125 5.45239V28.8274C5.8125 29.391 6.03638 29.9315 6.4349 30.33C6.83341 30.7285 7.37391 30.9524 7.9375 30.9524H27.0625C27.6261 30.9524 28.1666 30.7285 28.5651 30.33C28.9636 29.9315 29.1875 29.391 29.1875 28.8274V11.8274C29.1876 11.6878 29.1602 11.5496 29.1069 11.4206C29.0536 11.2916 28.9754 11.1744 28.8767 11.0757ZM21.75 23.5149H13.25C12.9682 23.5149 12.698 23.403 12.4987 23.2037C12.2994 23.0044 12.1875 22.7342 12.1875 22.4524C12.1875 22.1706 12.2994 21.9003 12.4987 21.7011C12.698 21.5018 12.9682 21.3899 13.25 21.3899H21.75C22.0318 21.3899 22.302 21.5018 22.5013 21.7011C22.7006 21.9003 22.8125 22.1706 22.8125 22.4524C22.8125 22.7342 22.7006 23.0044 22.5013 23.2037C22.302 23.403 22.0318 23.5149 21.75 23.5149ZM21.75 19.2649H13.25C12.9682 19.2649 12.698 19.153 12.4987 18.9537C12.2994 18.7544 12.1875 18.4842 12.1875 18.2024C12.1875 17.9206 12.2994 17.6503 12.4987 17.4511C12.698 17.2518 12.9682 17.1399 13.25 17.1399H21.75C22.0318 17.1399 22.302 17.2518 22.5013 17.4511C22.7006 17.6503 22.8125 17.9206 22.8125 18.2024C22.8125 18.4842 22.7006 18.7544 22.5013 18.9537C22.302 19.153 22.0318 19.2649 21.75 19.2649ZM20.6875 11.8274V5.98364L26.5312 11.8274H20.6875Z"
                                                fill="#DDDDDD" />
                                        </svg>
                                    </a>
                                @else
                                    @foreach ($invoice_files as $file)
                                        <a href="{{ empty($file) ? '#' : asset($file) }}" target="_blank"
                                            class="invoice-item {{ !empty($file) ? 'active' : '' }}">
                                            <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M28.8767 11.0757L21.4392 3.63817C21.3405 3.53954 21.2233 3.46132 21.0943 3.408C20.9653 3.35467 20.8271 3.32728 20.6875 3.32739H7.9375C7.37391 3.32739 6.83341 3.55128 6.4349 3.94979C6.03638 4.34831 5.8125 4.88881 5.8125 5.45239V28.8274C5.8125 29.391 6.03638 29.9315 6.4349 30.33C6.83341 30.7285 7.37391 30.9524 7.9375 30.9524H27.0625C27.6261 30.9524 28.1666 30.7285 28.5651 30.33C28.9636 29.9315 29.1875 29.391 29.1875 28.8274V11.8274C29.1876 11.6878 29.1602 11.5496 29.1069 11.4206C29.0536 11.2916 28.9754 11.1744 28.8767 11.0757ZM21.75 23.5149H13.25C12.9682 23.5149 12.698 23.403 12.4987 23.2037C12.2994 23.0044 12.1875 22.7342 12.1875 22.4524C12.1875 22.1706 12.2994 21.9003 12.4987 21.7011C12.698 21.5018 12.9682 21.3899 13.25 21.3899H21.75C22.0318 21.3899 22.302 21.5018 22.5013 21.7011C22.7006 21.9003 22.8125 22.1706 22.8125 22.4524C22.8125 22.7342 22.7006 23.0044 22.5013 23.2037C22.302 23.403 22.0318 23.5149 21.75 23.5149ZM21.75 19.2649H13.25C12.9682 19.2649 12.698 19.153 12.4987 18.9537C12.2994 18.7544 12.1875 18.4842 12.1875 18.2024C12.1875 17.9206 12.2994 17.6503 12.4987 17.4511C12.698 17.2518 12.9682 17.1399 13.25 17.1399H21.75C22.0318 17.1399 22.302 17.2518 22.5013 17.4511C22.7006 17.6503 22.8125 17.9206 22.8125 18.2024C22.8125 18.4842 22.7006 18.7544 22.5013 18.9537C22.302 19.153 22.0318 19.2649 21.75 19.2649ZM20.6875 11.8274V5.98364L26.5312 11.8274H20.6875Z"
                                                    fill="#DDDDDD" />
                                            </svg>
                                        </a>
                                    @endforeach
                                @endif
                            </div>
                        </td>
                        <td>
                            <div class="packing-list-items">
                                @if (count($packing_list_files) == 0)
                                    <a href="#" class="packing-list-item">
                                        <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M28.8767 11.0757L21.4392 3.63817C21.3405 3.53954 21.2233 3.46132 21.0943 3.408C20.9653 3.35467 20.8271 3.32728 20.6875 3.32739H7.9375C7.37391 3.32739 6.83341 3.55128 6.4349 3.94979C6.03638 4.34831 5.8125 4.88881 5.8125 5.45239V28.8274C5.8125 29.391 6.03638 29.9315 6.4349 30.33C6.83341 30.7285 7.37391 30.9524 7.9375 30.9524H27.0625C27.6261 30.9524 28.1666 30.7285 28.5651 30.33C28.9636 29.9315 29.1875 29.391 29.1875 28.8274V11.8274C29.1876 11.6878 29.1602 11.5496 29.1069 11.4206C29.0536 11.2916 28.9754 11.1744 28.8767 11.0757ZM21.75 23.5149H13.25C12.9682 23.5149 12.698 23.403 12.4987 23.2037C12.2994 23.0044 12.1875 22.7342 12.1875 22.4524C12.1875 22.1706 12.2994 21.9003 12.4987 21.7011C12.698 21.5018 12.9682 21.3899 13.25 21.3899H21.75C22.0318 21.3899 22.302 21.5018 22.5013 21.7011C22.7006 21.9003 22.8125 22.1706 22.8125 22.4524C22.8125 22.7342 22.7006 23.0044 22.5013 23.2037C22.302 23.403 22.0318 23.5149 21.75 23.5149ZM21.75 19.2649H13.25C12.9682 19.2649 12.698 19.153 12.4987 18.9537C12.2994 18.7544 12.1875 18.4842 12.1875 18.2024C12.1875 17.9206 12.2994 17.6503 12.4987 17.4511C12.698 17.2518 12.9682 17.1399 13.25 17.1399H21.75C22.0318 17.1399 22.302 17.2518 22.5013 17.4511C22.7006 17.6503 22.8125 17.9206 22.8125 18.2024C22.8125 18.4842 22.7006 18.7544 22.5013 18.9537C22.302 19.153 22.0318 19.2649 21.75 19.2649ZM20.6875 11.8274V5.98364L26.5312 11.8274H20.6875Z"
                                                fill="#DDDDDD" />
                                        </svg>
                                    </a>
                                @else
                                    @foreach ($packing_list_files as $file)
                                        <a href="{{ empty($file) ? '#' : asset($file) }}" target="_blank"
                                            class="packing-list-item {{ !empty($file) ? 'active' : '' }}">
                                            <svg width="35" height="35" viewBox="0 0 35 35" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M28.8767 11.0757L21.4392 3.63817C21.3405 3.53954 21.2233 3.46132 21.0943 3.408C20.9653 3.35467 20.8271 3.32728 20.6875 3.32739H7.9375C7.37391 3.32739 6.83341 3.55128 6.4349 3.94979C6.03638 4.34831 5.8125 4.88881 5.8125 5.45239V28.8274C5.8125 29.391 6.03638 29.9315 6.4349 30.33C6.83341 30.7285 7.37391 30.9524 7.9375 30.9524H27.0625C27.6261 30.9524 28.1666 30.7285 28.5651 30.33C28.9636 29.9315 29.1875 29.391 29.1875 28.8274V11.8274C29.1876 11.6878 29.1602 11.5496 29.1069 11.4206C29.0536 11.2916 28.9754 11.1744 28.8767 11.0757ZM21.75 23.5149H13.25C12.9682 23.5149 12.698 23.403 12.4987 23.2037C12.2994 23.0044 12.1875 22.7342 12.1875 22.4524C12.1875 22.1706 12.2994 21.9003 12.4987 21.7011C12.698 21.5018 12.9682 21.3899 13.25 21.3899H21.75C22.0318 21.3899 22.302 21.5018 22.5013 21.7011C22.7006 21.9003 22.8125 22.1706 22.8125 22.4524C22.8125 22.7342 22.7006 23.0044 22.5013 23.2037C22.302 23.403 22.0318 23.5149 21.75 23.5149ZM21.75 19.2649H13.25C12.9682 19.2649 12.698 19.153 12.4987 18.9537C12.2994 18.7544 12.1875 18.4842 12.1875 18.2024C12.1875 17.9206 12.2994 17.6503 12.4987 17.4511C12.698 17.2518 12.9682 17.1399 13.25 17.1399H21.75C22.0318 17.1399 22.302 17.2518 22.5013 17.4511C22.7006 17.6503 22.8125 17.9206 22.8125 18.2024C22.8125 18.4842 22.7006 18.7544 22.5013 18.9537C22.302 19.153 22.0318 19.2649 21.75 19.2649ZM20.6875 11.8274V5.98364L26.5312 11.8274H20.6875Z"
                                                    fill="#DDDDDD" />
                                            </svg>
                                        </a>
                                    @endforeach
                                @endif
                            </div>
                        </td>
                        <td>
                            <!-- Status classlar success, pending, reject -->
                            <div class="status-txt success">
                                <span></span>
                                <p>{{ trns('confirmed') }}</p>
                            </div>
                            <p class="time">
                                {{ $latest_status?->created_at?->format('d.m.Y') ?? 'Tarix yoxdur' }}
                            </p>
                        </td>
                        <td>
                            <form action="{{ route('admin.order.execute', $order_item->order_id) }}" method="post">
                                @csrf
                                @method('PUT')
                                <div class="confirmedOrders-buttons">
                                    @can('Təsdiqlənən sifarişlər-Sifariş mlmt. Daxil et')
                                        <a href="{{ route('admin.order.edit', $order_item->order_item_id) }}"
                                            class="enter-orderDetails">
                                            {{ trns('enter_order_info') }}
                                        </a>
                                    @endcan
                                    @csrf
                                    @if (count($invoice_files ?? []) > 0 &&
                                            count($packing_list_files ?? []) > 0 &&
                                            !is_null($order?->price) &&
                                            count($order_factories) > 0)
                                        @can('Təsdiqlənən sifarişlər-Sfrş. mlmt. Daxil et-Təsdiq et')
                                            @if ($order_item->mix_full == 'full')
                                                @if ($order_item->container_type)
                                                    <button class="send-execution" type="submit">
                                                        {{ trns('send_execute') }}
                                                    </button>
                                                @endif
                                            @else
                                                <button class="send-execution" type="submit">
                                                    {{ trns('send_execute') }}
                                                </button>
                                            @endif
                                        @endcan
                                    @endif
                                </div>
                            </form>
                        </td>
                    </tr>
                @endforeach
            </tbody>
        </table>
    </div>
</div>
